<div class="container mt-4">
  <h1 class="text-center">Tracks</h1>
  <!-- SEARCH BAR -->
  <%= form_with(url: tracks_path, method: :get, local: true, class: 'mb-3') do %>
    <div class="input-group">
      <%= text_field_tag :search, params[:search], class: 'form-control', placeholder: 'Search tracks...' %>
      <div class="input-group-append">
        <%= submit_tag 'Search', class: 'btn btn-primary' %>
      </div>
    </div>
  <% end %>
  <!-- TABLE -->
  <table id="tracks-table" class="table table-striped table-hover" data-controller="sort">
    <thead class="thead-dark">
    <tr>
      <th data-action="click->sort#sort" data-sort-column="name" class="sortable">Name <%= sort_icon('name') %></th>
      <th data-action="click->sort#sort" data-sort-column="artists.name" class="sortable">Artist(s) <%= sort_icon('artists.name') %></th>
      <th data-action="click->sort#sort" data-sort-column="keys.name" class="sortable">Key <%= sort_icon('keys.name') %></th>
      <th data-action="click->sort#sort" data-sort-column="bpm" class="sortable">BPM <%= sort_icon('bpm') %></th>
      <th data-action="click->sort#sort" data-sort-column="time" class="sortable">Time <%= sort_icon('time') %></th>
      <th data-action="click->sort#sort" data-sort-column="album" class="sortable">Album <%= sort_icon('album') %></th>
      <th>Date Added</th>
      <th data-action="click->sort#sort" data-sort-column="playlists.name" class="sortable">Playlists <%= sort_icon('playlists.name') %></th>
    </tr>
    </thead>
    <tbody>
    <% @tracks.each do |track| %>
      <tr>
        <td><%= track.name %></td>
        <td>
          <% track.artists.each do |artist| %>
            <%= link_to artist.name, artist_path(artist), class: 'text-decoration-none text-dark' %>
            <%= ',' unless artist == track.artists.last %>
          <% end %>
        </td>
        <td><%= link_to track.key&.name, key_path(track.key), class: 'text-decoration-none text-dark' if track.key %></td>
        <td><%= track.bpm %></td>
        <td><%= format_time(track.time) %></td>
        <td><%= track.album %></td>
        <td><%= track.date_added %></td>
        <td>
          <% track.playlists.each do |playlist| %>
            <%= link_to playlist.name, playlist_path(playlist), class: 'text-decoration-none text-dark' %>
            <%= ',' unless playlist == track.playlists.last %>
          <% end %>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>
  <!-- PAGINATION -->
  <div class="d-flex justify-content-center">
    <%== pagy_bootstrap_nav(@pagy) if @pagy.pages > 1 %>
  </div>
</div>

